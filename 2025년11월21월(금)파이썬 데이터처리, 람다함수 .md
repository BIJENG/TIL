# 파이썬 데이터 처리 & 람다 함수

## 1. 람다함수 (Lambda Functions)
람다 함수는 **간단한 함수를 한 줄로 정의할 수 있는 익명 함수**입니다.  
의료 데이터 처리에서 환자 목록 정렬, 조건부 필터링, 데이터 변환 등에 유용합니다.

### 왜 람다 함수가 필요할까?
- 간단한 작업을 위해 함수를 계속 정의하는 번거로움 제거
- 데이터 정렬/필터링 시 편리함 제공

### 예시 1: 일반 함수 vs 람다 함수
```python
# 일반 함수
def add(a, b):
    return a + b
add(1, 2)  # 3

# 람다 함수
add = lambda a, b: a + b
add(1, 2)  # 3
# 일반 함수
def calculate_bmi(weight, height):
    return weight / (height ** 2)

# 람다 함수
calculate_bmi_lambda = lambda weight, height: weight / (height ** 2)
calculate_bmi_lambda(70, 1.75)  # BMI 값 계산
람다 함수는 return 키워드 없이 표현식(expression) 결과를 자동으로 반환

x + 5       # 계산 표현식
"hello"     # 문자열 표현식
x > 10      # 비교 표현식
a if b else c  # 조건 표현식

2. 삼항 연산자
value1 if 조건식 else value2
lue1 if 조건식 else value2
조건식이 True면 value1 반환
조건식이 False면 value2 반환
age = 10
adult = "성인" if age >= 18 else "미성년자"

3. 람다 함수 + 내포(list comprehension) 예시
get_risk = lambda p: "고위험" if p["systolic"] >= 160 else "중위험" if p["systolic"] >= 140 else "저위험"
risk_levels = [get_risk(p) for p in patients]

⚠️ 람다 함수 사용 주의
-사용하면 좋은 경우
-간단한 계산이나 변환
-일회성 정렬/필터링
-map, filter, sorted와 함께
-즉석 데이터 처리

사용하지 말아야 할 경우
-복잡한 로직 (3줄 이상)
-반복적으로 사용되는 함수
-디버깅이 중요한 핵심 로직
-다른 사람이 이해하기 어려운 복잡한 조건

4. JSON 데이터 처리
Python -> JSON 변환
import json

patient_info = {
    "patient_id": "P001",
    "name": "박환자",
    "age": 45,
    "department": "내과",
    "diagnosis": ["고혈압", "당뇨병"],
    "medications": ["혈압약", "당뇨약"],
    "is_emergency": False,
    "blood_sugar": 120.5
}

json_string = json.dumps(
    patient_info,
    ensure_ascii=False,  # 한글 그대로 저장
    indent=2             # 들여쓰기 2칸
)

print(json_string)
print(f"데이터 타입: {type(json_string)}")  # <class 'str'>
JSON 문자열은 문자열(str) 형태입니다.

JSON 문자열 -> Python 딕셔너리
device_data = json.loads(json_string)
print(device_data)
print(f"데이터 타입: {type(device_data)}")  # <class 'dict'>

딕셔너리에서 데이터 추출
data["vital_signs"]["heart_rate"]
data.get("vital_signs").get("heart_rate")

Python 데이터타입과 JSON 대응
Python	        JSON	        의료 데이터 예시
dict	            {}	        환자 정보, 진료 기록
list	            []	        진단명 목록, 처방약 목록
str	          "string"	      환자명, 진단명
int, float	    number	      나이, 혈압, 체온
True/False	  true/false	    입원 여부, 응급 상태
None	            null	      미입력 데이터

5. JSON 파일 저장
with open('patient_records.json', 'w', encoding='utf-8') as file:
    json.dump(
        patient_records,    # Python 데이터
        file,               # 파일 객체
        ensure_ascii=False,
        indent=2
    )

print("환자 기록이 patient_records.json 파일로 저장되었습니다!")
파일 저장 시 단수형 dump() 사용
문자열 반환이 필요한 경우는 dumps()

JSON 파일 불러오기
try:
    with open('patient_records.json', 'r', encoding='utf-8') as file:
        loaded_records = json.load(file)

    for record in loaded_records:
        print(f"환자 ID: {record['patient_id']}")
        print(f"이름: {record['name']} ({record['age']}세)")
        print(f"진료과: {record['department']}")
        print(f"주 진단: {record['diagnosis'][0]}")  # 첫 번째 진단
        vitals = record['vitals']
        print(f"혈압: {vitals['blood_pressure']}, 심박수: {vitals['heart_rate']}bpm")
        status = "퇴원" if record['is_discharged'] else "입원 중"
        print(f"상태: {status}")
        med_count = len(record['medications'])
        print(f"처방약: {med_count}개")
        print("-" * 40)

except FileNotFoundError:
    print("patient_records.json 파일을 찾을 수 없습니다.")
except json.JSONDecodeError:
    print("JSON 파일 형식이 올바르지 않습니다.")

6. CSV 파일 처리
import csv

# CSV 저장
with open('vital_signs.csv', 'w', newline='', encoding='utf-8') as file:
    writer = csv.writer(file)
    writer.writerows(vital_signs_data)

# CSV 읽기
with open('vital_signs.csv', 'r', encoding='utf-8') as file:
    reader = csv.reader(file)
    for i, row in enumerate(reader):
        if i == 0:
            print(" * ".join(row))  # 헤더
            print("-" * 80)
        else:
            print(" | ".join(row))  # 데이터
7. 요약
람다 함수: 짧고 간단한 데이터 처리/변환에 적합
삼항 연산자: 조건에 따라 값을 선택
JSON: Python 객체 ↔ JSON 문자열 ↔ 파일 저장
CSV: 표 형태 데이터 저장 및 불러오기
의료 데이터 처리: 람다 + JSON/CSV 조합으로 효율적 관리 가능
