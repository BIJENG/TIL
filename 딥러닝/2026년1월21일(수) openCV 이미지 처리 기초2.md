# 📘 OpenCV 이미지 처리 및 헬스케어 활용 기초

---

## 1. 임계처리 (Thresholding)
이미지를 흑과 백(이진화)으로 나누는 가장 기초적인 분할 기법입니다. 특정 기준값(Threshold)보다 픽셀값이 높으면 255(흰색), 낮으면 0(검은색)으로 바꿉니다.

### 💡 핵심 개념
* **이진화(Binarization):** 애매한 회색 영역을 없애고 데이터를 단순화함.
* **적응형 임계처리(Adaptive Threshold):** 조명이 불균일할 때, 이미지의 작은 구역별로 기준을 다르게 적용함.

### 🏥 헬스케어 활용
* **X-ray 뼈 분리:** 뼈(밝은색)와 배경(어두운색)을 명확하게 분리할 때 사용.
* **세포 계수:** 현미경 이미지에서 세포 영역만 흰색으로 만들어 개수를 셀 때 필수적임.

```python
import cv2

# 임계값 127을 기준으로 나눔 (THRESH_BINARY)
ret, thresh = cv2.threshold(img, 127, 255, cv2.THRESH_BINARY)
```

---

## 2. 기하학적 변환 (Geometric Transformations)
이미지의 좌표를 이동시키거나 회전, 크기 조절 등을 통해 형태를 변형하는 기술입니다.

**① 아핀 변환 (cv2.warpAffine)**
- 설명: 이미지를 평행 이동(Shift), 회전(Rotation), 크기 조절(Scaling) 할 때 사용합니다.
- 특징: 직선은 변환 후에도 직선으로 유지되며, 평행선도 평행하게 유지됩니다. (2x3 행렬 사용)

**② 투시 변환 (cv2.warpPerspective)**
- 설명: 이미지를 3차원 공간에서 기울여서 보는 것처럼 원근감을 조절합니다.
- 특징: 찌그러진 문서를 똑바로 펴는 스캔 효과와 같습니다. (3x3 행렬 사용)

**🏥 헬스케어 활용 (Data Augmentation)**
- 데이터 증강: 환자 데이터가 부족할 때, 이미지를 살짝 회전하거나 이동시켜 학습 데이터를 인위적으로 늘리는 데 사용합니다.
- 이미지 정합(Registration): 환자가 움직여서 삐뚤어진 CT/MRI 사진을 바른 위치로 보정할 때 사용합니다.

```python

# 아핀 변환 (이동) 예시
M = np.float32([[1, 0, 100], [0, 1, 50]]) # x축 100, y축 50 이동
dst = cv2.warpAffine(img, M, (cols, rows))
```

---

## 3. 색상 공간 (Color Spaces)
컴퓨터가 색을 인식하는 방식을 변경합니다. OpenCV는 기본적으로 BGR 순서를 사용합니다.

**💡 주요 색상 공간**
- BGR/RGB: 빛의 3원색. 화면 출력용.
- HSV (Hue, Saturation, Value): 색상(H), 채도(S), 명도(V)로 구분. 인간의 직관과 비슷함.
- YCrCb: 밝기(Y)와 색차(Cr, Cb) 정보를 분리. 피부색 검출에 유리함.

**🏥 헬스케어 활용**
- 피부 병변 분석: 조명의 영향을 덜 받는 HSV 공간을 사용하여 피부암이나 염증 부위의 '붉은색'만 정밀하게 추출할 때 사용합니다.

```python

# BGR -> Gray 변환 (가장 많이 씀)
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# BGR -> HSV 변환
hsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)
```

---

## 4. 얼굴 검출 (Face Detection)
이미지에서 사람의 얼굴 위치를 찾아내는 기술입니다. 전통적으로 Haar Cascade 알고리즘을 많이 사용했습니다.

**💡 Haar Cascade**
- 학습된 XML 파일(눈, 코, 입의 명암 패턴)을 사용하여 빠르게 얼굴을 찾습니다.
- 단점: 얼굴이 기울어지거나 가려지면 인식이 잘 안 될 수 있음 (최근엔 딥러닝 기반 Mediapipe 등을 선호).

**🏥 헬스케어 활용 (개인정보 보호)**
- 비식별화(De-identification): 의료 데이터를 연구용으로 공개할 때, 환자의 프라이버시를 위해 얼굴 영역을 찾아 자동으로 블러(Blur) 처리하거나 모자이크 하는 데 필수적으로 사용됩니다.

```python

# 얼굴 검출기 로드
face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')
# 얼굴 탐색
faces = face_cascade.detectMultiScale(gray, 1.1, 4)
```

---

## 📝 오늘의 회고
- 데이터 전처리의 중요성: AI 모델에 넣기 전에 warpAffine 등으로 데이터를 정제하고 증강하는 과정이 필수적임을 깨달았다.
- 의료 데이터의 특수성: 단순 변환이 아니라, 환자의 개인정보 보호(얼굴 가리기)나 병변 추출(색상 공간)과 어떻게 연결되는지 이해했다.
